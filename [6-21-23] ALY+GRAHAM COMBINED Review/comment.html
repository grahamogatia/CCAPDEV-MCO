<!DOCTYPE html>
<html>
<head>
  <title>Comment Section</title>
  <link rel="stylesheet" href="comments.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Mukta:wght@400;700&display=swap');

    .fa-star {
      color: gray;
      cursor: pointer;
    }

    .fa-star.checked {
      color: gold;
    }

    /* index */

    .review-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 450px;
      width: 450px;
      background-color: #1e5631;
      margin-top: 20px;
      color: white;
      font-family: 'Mukta', sans-serif;
      border-radius: 25px;
      margin: 0 auto; /* Center the container horizontally */
    }

    .restaurant-name {
        font-size: 30px;
        margin-bottom: 0px;
    }

    .user-container {
        display: flex;
        margin-right: auto;
        margin-left: 20px;
    }

        .profile {
            height: 50px;
            width: 50px;
        }



        .user {
            display: flex;
            flex-direction: column;
            margin-left: 10px;
        }

        .name {
            font-size: 25px;
            font-weight: bolder;
            /* margin-bottom: -5px; */
        }

        .notice {
            font-size: 12px;
            margin-top: -10px;
        }

    .ratings {
        margin-top: 0px;
    }

        .fa.fa-star.fa-2x:hover {
            color: orange;
        }

    .write-review {
        margin-top: 10px;
    }
        .textbox {
            height: 150px;
            width: 400px;
            font-family: 'Mukta', sans-serif;
            resize: none;
            
        }

    .button-container {
        margin: 20px;
        margin-left: auto;
    }
        .button {
            border-radius: 25px;
            font-family: 'Mukta', sans-serif;
        }




    /* comment */
    body {
        margin: 0;
        padding-top: 50px;
        font-family: 'Mukta', sans-serif;
      }

      .header {
        position: fixed;
        top: 0;
        width: 100%;
        height: 50px;
        background-color: #1E5631;
        padding: 0 10px;
        display: flex;
        align-items: center;
      }

      .header .button {
        padding: 5px 10px;
        color: black;
        border: none;
        cursor: pointer;
      }

      .header .button:hover {
        background-color: lightgray;
      }

      .header .buttonlog {
        padding: 5px 10px;
        color: #d21404;
        border: none;
        cursor: pointer;
      }

      .header .buttonlog:hover {
        background-color: darksalmon;
      }

      .search-bar {
        display: flex;
        align-items: center;
        height: 35px;
        max-width: 500px;
        margin: 0 auto;
        background-color: #fff;
        padding: 0 5px;
        border-radius: 5px;
      }

      .profpic {
        display: flex; 
        align-items: center;
        width: 40px;
        height: 40px;
        margin-right: 20px;
      }

      #logopic {
        width: 45px;
        height: 45px;
      }

      #commentpic {
        width: 20px;
        height: 20px;
      }

      .search-bar input[type="text"] {
        flex: 1;
        border: none;
        padding: 5px;
        font-size: 16px;
        transition: background-color 0.3s;
        outline: none;
      }

      .search-bar input[type="text"]:hover {
        background-color: #D3D3D3;
      }

      .search-bar input[type="text"] {
        flex: 1;
        border: none;
        padding: 5px;
        font-size: 13px;
        width: 1000px;
      }

      .search-bar button {
        padding: 5px 10px;
        background-color: #4C9A2A;
        color: #fff;
        border: none;
        cursor: pointer;
      }

      .search-bar button:hover {
        background-color: #ACDF87;
      }

      .dropdown {
        position: relative;
        display: inline-block;
        align-items: center;
      }

      #dropdownContent {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        right: 40%;
      }

      .dropdown:hover #dropdownContent {
        display: block;
      }

      .dropdown a {
        display: block;
        text-decoration: none;
        color: #333;
      }

      .dropdown a:hover {
        background-color: #ddd;
      }

      #comments-container {
        max-width: 500px;
        min-height: 500px;
        margin: 20px auto 20px; 
        padding: 30px;
        background-color: #1E5631;
        padding-top: 3px;
        border-radius: 10px;
      }
      
      #comments-list {
        margin-bottom: 20px;
      }
      
      .comment {
        margin-bottom: 10px;
        padding: 10px;
        background-color: white;
        border-radius: 10px; 
      }
      
      .comment-actions button {
        margin-right: 5px;
        border: none;
        background-color: transparent;
        cursor: pointer;
        padding: 2px;
        font-size: 16px;
      }
      
      .comment-actions button:hover {
        color: black;
      }
      
      .comment-actions button:focus {
        outline: none;
      }
      
      .comment-actions .upvote {
        color: #FF5700;
      }
      
      .comment-actions .downvote {
        color: #7193FF;
      }
      
      .reply-form {
        margin-left: 20px;
      }
      
      .reply-form textarea {
        margin-bottom: 5px;
        width: 430px;
        padding: 5px;
        resize: vertical;
      }
      
      .reply-form button {
        padding: 5px 10px;
      }

      .profile-picture {
        width: 30px; 
        height: 30px; 
        border-radius: 50%;
        margin-right: 10px;
        float: left; 
      }

      .comment p {
        margin: 0;
        overflow: hidden; 
        overflow-wrap: break-word;
      }

      .comment-actions {
        overflow: hidden;
      }

      body {
        background-color: white;
      }

      .last-edited {
        color:rgb(109, 109, 109);

      }
  </style>
</head>

<body>
  <div id="comments-container">
    <h1 style="color: white;">Comments</h1>
    <div id="comments-list"></div>
  </div>

  <form id="comment-form">
    <div class="review-container">
      <div class="restaurant-name">
        <p id="restaurantName">Restaurant Name</p>
      </div>

      <div class="user-container">
        <div style="display: flex; justify-content: center; align-items: center;">
          <img src="icons/profile.png" class="profile" />
        </div>        
        
        <div class="user">
          <p class="name">Bob Ross</p> 
        </div>
      </div>

      <div class="ratings">
        <span class="fa fa-star fa-2x" onclick="toggleRating(0)"></span>
        <span class="fa fa-star fa-2x" onclick="toggleRating(1)"></span>
        <span class="fa fa-star fa-2x" onclick="toggleRating(2)"></span>
        <span class="fa fa-star fa-2x" onclick="toggleRating(3)"></span>
        <span class="fa fa-star fa-2x" onclick="toggleRating(4)"></span>
      </div>

      <div class="write-review">
        <textarea id="reviewText" placeholder="Write a review..."></textarea>
      </div>

      <div class="button-container">
        <button class="button" onclick="passValues()">Submit Review</button>
      </div>
    </div>
  </form>
  <button onclick="clearLocalStorage()">Clear Local Storage</button>


  <script>
    function clearLocalStorage() {
      localStorage.clear();
      console.log('Local storage cleared.');
    }

    document.addEventListener("DOMContentLoaded", function() {
      displayComments(); 
    });

    function passValues() {
      var username = "Bob Ross"; 
      var restaurantName = document.getElementById('restaurantName').innerText;
      var ratings = document.getElementsByClassName('fa-star fa-2x');
      var starRating = 0;
      for (var i = 0; i < ratings.length; i++) {
        if (ratings[i].classList.contains('checked')) {
          starRating++;
        }
      }

      var reviewText = document.getElementById('reviewText').value;
      var existingReviews = localStorage.getItem('reviews');
      var reviewsArray = existingReviews ? JSON.parse(existingReviews) : [];
      reviewsArray.push({ username: username, restaurantName: restaurantName, starRating: starRating, reviewText: reviewText });
      localStorage.setItem('reviews', JSON.stringify(reviewsArray));

      displayComments(); 

      document.getElementById('reviewText').value = "";
      for (var i = 0; i < ratings.length; i++) {
        ratings[i].classList.remove('checked');
      }
    }

    function displayComments() {
      var commentsContainer = document.getElementById('comments-list');
      var existingReviews = localStorage.getItem('reviews');
      var reviewsArray = existingReviews ? JSON.parse(existingReviews) : [];

      reviewsArray.unshift(
        {
          username: "John Doe",
          restaurantName: "24 Chicken",
          starRating: 4,
          reviewText: "Great food and friendly staff!",
          upvotes: 10,
          downvotes: 2,
        },

        {
          username: "Jane Smith",
          restaurantName: "24 Chicken",
          starRating: 5,
          reviewText: "Excellent service and atmosphere!",
          upvotes: 5,
          downvotes: 0,
        },

        {
          username: "Bob Adams",
          restaurantName: "24 Chicken",
          starRating: 4,
          reviewText: "Great food and friendly staff!",
          upvotes: 10,
          downvotes: 2,
        },

        {
          username: "Austin Uy",
          restaurantName: "24 Chicken",
          starRating: 5,
          reviewText: "Excellent service and atmosphere!",
          upvotes: 5,
          downvotes: 0,
        },

        {
          username: "Jane Smith",
          restaurantName: "24 Chicken",
          starRating: 5,
          reviewText: "Excellent service and atmosphere!",
          upvotes: 5,
          downvotes: 0,
        }
      );

      var commentsHTML = "";

      for (var i = 0; i < reviewsArray.length; i++) {
        var comment = reviewsArray[i];
        commentsHTML += "<div class='comment'>";
        commentsHTML += "<div class='user-container'>";
        commentsHTML += "<div><img src='icons/admin.png' class='profile' /></div>";
        commentsHTML += "<div class='user'>";
        commentsHTML += "<p class='name'>" + comment.username + "</p>";
        commentsHTML += "<div class='ratings'>";
        for (var j = 0; j < comment.starRating; j++) {
          commentsHTML += "<span class='fa fa-star checked'></span>";
        }
        for (var k = comment.starRating; k < 5; k++) {
          commentsHTML += "<span class='fa fa-star'></span>";
        }
        commentsHTML += "</div>";
        commentsHTML += "<p class='review'>" + comment.reviewText + "</p>";

        if (comment.lastEdited) {
          var lastEditedDate = new Date(comment.lastEdited);
          commentsHTML += "<p class='last-edited'>Last edited: " + lastEditedDate.toLocaleString() + "</p>";
        }

        commentsHTML += "<div class='comment-actions'>";
        commentsHTML += "<button class='upvote' onclick='upvoteComment(" + i + ")'>▲</button>";
        commentsHTML += "<span class='upvote-count'>" + (comment.upvotes || 0) + "</span>";
        commentsHTML += "<button class='downvote' onclick='downvoteComment(" + i + ")'>▼</button>";
        commentsHTML += "<span class='downvote-count'>" + (comment.downvotes || 0) + "</span>";
        commentsHTML += "<button class='delete-comment' onclick='deleteComment(" + i + ")'>Delete</button>";
        commentsHTML += "<button class='edit-comment' onclick='editComment(" + i + ")'>Edit</button>";

        commentsHTML += "<div class='reply-form' id='replyForm-" + i + "'>";
        commentsHTML += "<textarea id='replyText-" + i + "' placeholder='Write a reply...' style='width: 200px;'></textarea>";
        commentsHTML += "<button onclick='postReply(" + i + ")'>Post</button>";
        commentsHTML += "</div>";
        commentsHTML += "</div>";
        commentsHTML += "</div>";
        commentsHTML += "</div>";
        commentsHTML += "</div>";
      }

      commentsContainer.innerHTML = commentsHTML;
}


function deleteComment(commentIndex) {
  var existingReviews = localStorage.getItem('reviews');
  var reviewsArray = existingReviews ? JSON.parse(existingReviews) : [];
  reviewsArray.splice(commentIndex, 1);
  localStorage.setItem('reviews', JSON.stringify(reviewsArray));
  displayComments(); 
}

function editComment(commentIndex) {
  var existingReviews = localStorage.getItem('reviews');
  var reviewsArray = existingReviews ? JSON.parse(existingReviews) : [];
  var comment = reviewsArray[commentIndex];
  var updatedText = prompt("Edit your comment:", comment.reviewText);

  if (updatedText) {
    var currentTimestamp = new Date().toISOString();
    comment.reviewText = updatedText;
    comment.lastEdited = currentTimestamp;
    localStorage.setItem('reviews', JSON.stringify(reviewsArray));
    displayComments(); 
  }
}

function upvoteComment(commentIndex) {
  var existingReviews = localStorage.getItem('reviews');
  var reviewsArray = existingReviews ? JSON.parse(existingReviews) : [];
  var comment = reviewsArray[commentIndex];
  comment.upvotes = (comment.upvotes || 0) + 1;
  var replyText = comment.replyText;
  localStorage.setItem('reviews', JSON.stringify(reviewsArray));
  var upvoteCountElement = document.querySelector("#comments-list .comment:nth-child(" + (commentIndex + 1) + ") .upvote-count");
  upvoteCountElement.innerText = comment.upvotes || 0;
  comment.replyText = replyText;
}

function downvoteComment(commentIndex) {
  var existingReviews = localStorage.getItem('reviews');
  var reviewsArray = existingReviews ? JSON.parse(existingReviews) : [];
  var comment = reviewsArray[commentIndex];
  comment.downvotes = (comment.downvotes || 0) + 1;
  var replyText = comment.replyText;
  localStorage.setItem('reviews', JSON.stringify(reviewsArray));
  var downvoteCountElement = document.querySelector("#comments-list .comment:nth-child(" + (commentIndex + 1) + ") .downvote-count");
  downvoteCountElement.innerText = comment.downvotes || 0;
  comment.replyText = replyText;
}

var indicesWithDefaultReplies = [0, 1, 2, 3, 4];

var defaultReplies = {
  0: "Thank you for your comment!",
  1: "We appreciate your feedback.",
  2: "Thank you for your comment!",
  3: "We appreciate your feedback.",
  4: "Glad to hear that you enjoyed your experience."
};

function postReply(index) {
  var replyText = document.getElementById('replyText-' + index).value;
  var parentCommentContainer = document.getElementById('comments-list').children[index];

  var childCommentContainer = document.createElement('div');
  childCommentContainer.classList.add('comment');

  var userContainer = document.createElement('div');
  userContainer.classList.add('user-container');
  childCommentContainer.appendChild(userContainer);

  var profilePicture = document.createElement('div');
  profilePicture.innerHTML = '<img src="icons/owner.png" class="profile" />';
  userContainer.appendChild(profilePicture);

  var userInfoContainer = document.createElement('div');
  userInfoContainer.classList.add('user');
  userContainer.appendChild(userInfoContainer);

  var username = document.createElement('p');
  username.classList.add('name');
  username.innerText = 'Owner';
  userInfoContainer.appendChild(username);

  var resto = document.createElement('p');
  resto.innerText = 'Restaurant Name';
  userInfoContainer.appendChild(resto);

  var replyContent = document.createElement('p');
  replyContent.classList.add('reply-text');
  replyContent.style.marginLeft = '80px';
  replyContent.innerText = replyText;
  
  childCommentContainer.appendChild(replyContent); 

  var commentActionsContainer = document.createElement('div');
  commentActionsContainer.classList.add('comment-actions');
  commentActionsContainer.style.marginLeft = '80px';
  childCommentContainer.appendChild(commentActionsContainer);
  
  var upvoteButton = document.createElement('button');
  upvoteButton.classList.add('upvote');
  upvoteButton.innerHTML = '▲';
  commentActionsContainer.appendChild(upvoteButton);

  var upvoteCount = document.createElement('span');
  upvoteCount.classList.add('vote-count');
  upvoteCount.innerText = '0';
  commentActionsContainer.appendChild(upvoteCount);

  var downvoteButton = document.createElement('button');
  downvoteButton.classList.add('downvote');
  downvoteButton.innerHTML = '▼';
  commentActionsContainer.appendChild(downvoteButton);

  var downvoteCount = document.createElement('span');
  downvoteCount.classList.add('vote-count');
  downvoteCount.innerText = '0';
  commentActionsContainer.appendChild(downvoteCount);

  var deleteButton = document.createElement('button');
  deleteButton.classList.add('delete-comment');
  deleteButton.innerHTML = 'Delete';
  commentActionsContainer.appendChild(deleteButton);

  var editButton = document.createElement('button');
  editButton.classList.add('edit-comment');
  editButton.innerHTML = 'Edit';
  commentActionsContainer.appendChild(editButton);

  parentCommentContainer.appendChild(childCommentContainer);

  document.getElementById('replyText-' + index).value = '';

  upvoteButton.addEventListener('click', function() {
    incrementVote(upvoteCount);
  });

  downvoteButton.addEventListener('click', function() {
    incrementVote(downvoteCount);
  });

  editButton.addEventListener('click', function() {
    editComment1(replyContent);
  });

  deleteButton.addEventListener('click', function() {
    deleteComment1(childCommentContainer);
  });

  var currentTimestamp = new Date().toISOString();
  childCommentContainer.lastEdited = currentTimestamp;
}

function postReplydefault(index) {
  var replyText = document.getElementById('replyText-' + index).value;
  var parentCommentContainer = document.getElementById('comments-list').children[index];

  var childCommentContainer = document.createElement('div');
  childCommentContainer.classList.add('comment');

  var userContainer = document.createElement('div');
  userContainer.classList.add('user-container');
  childCommentContainer.appendChild(userContainer);

  var profilePicture = document.createElement('div');
  profilePicture.innerHTML = '<img src="icons/owner.png" class="profile" />';
  userContainer.appendChild(profilePicture);

  var userInfoContainer = document.createElement('div');
  userInfoContainer.classList.add('user');
  userContainer.appendChild(userInfoContainer);

  var username = document.createElement('p');
  username.classList.add('name');
  username.innerText = 'Owner';
  userInfoContainer.appendChild(username);

  var resto = document.createElement('p');
  resto.innerText = 'Restaurant Name';
  userInfoContainer.appendChild(resto);

  var replyContent = document.createElement('p');
  replyContent.classList.add('reply-text');
  replyContent.style.marginLeft = '80px';

  if (indicesWithDefaultReplies.includes(index)) {
    if (defaultReplies.hasOwnProperty(index)) {
      replyContent.innerText = defaultReplies[index];
    } else {
      replyContent.innerText = "Default reply for index " + index;
    }
  } else {
    replyContent.innerText = replyText;
  }

  childCommentContainer.appendChild(replyContent); 

  var commentActionsContainer = document.createElement('div');
  commentActionsContainer.classList.add('comment-actions');
  commentActionsContainer.style.marginLeft = '80px';
  childCommentContainer.appendChild(commentActionsContainer);

  var upvoteButton = document.createElement('button');
  upvoteButton.classList.add('upvote');
  upvoteButton.innerHTML = '▲';
  commentActionsContainer.appendChild(upvoteButton);

  var upvoteCount = document.createElement('span');
  upvoteCount.classList.add('vote-count');
  upvoteCount.innerText = '0';
  commentActionsContainer.appendChild(upvoteCount);

  var downvoteButton = document.createElement('button');
  downvoteButton.classList.add('downvote');
  downvoteButton.innerHTML = '▼';
  commentActionsContainer.appendChild(downvoteButton);

  var downvoteCount = document.createElement('span');
  downvoteCount.classList.add('vote-count');
  downvoteCount.innerText = '0';
  commentActionsContainer.appendChild(downvoteCount);

  var deleteButton = document.createElement('button');
  deleteButton.classList.add('delete-comment');
  deleteButton.innerHTML = 'Delete';
  commentActionsContainer.appendChild(deleteButton);

  var editButton = document.createElement('button');
  editButton.classList.add('edit-comment');
  editButton.innerHTML = 'Edit';
  commentActionsContainer.appendChild(editButton);

  parentCommentContainer.appendChild(childCommentContainer);

  document.getElementById('replyText-' + index).value = '';

  upvoteButton.addEventListener('click', function() {
    incrementVote(upvoteCount);
  });

  downvoteButton.addEventListener('click', function() {
    incrementVote(downvoteCount);
  });

  editButton.addEventListener('click', function() {
    editComment1(replyContent);
  });

  deleteButton.addEventListener('click', function() {
    deleteComment1(childCommentContainer);
  });

  var currentTimestamp = new Date().toISOString();
  childCommentContainer.lastEdited = currentTimestamp;
}

window.onload = function() {
  indicesWithDefaultReplies.forEach(function(index) {
    if (defaultReplies.hasOwnProperty(index)) {
      postReplydefault(index, defaultReplies[index]);
    }
  });
};

function incrementVote(voteCountElement) {
  var count = parseInt(voteCountElement.innerText);
  voteCountElement.innerText = count + 1;
}

function editComment1(replyContentElement) {
  var newText = prompt('Enter the new comment:');
  replyContentElement.innerText = newText;

  var commentContainer = replyContentElement.parentNode.parentNode;
  var currentTimestamp = new Date().toISOString();
  commentContainer.lastEdited = currentTimestamp;
}

function deleteComment1(commentContainer) {
  commentContainer.parentNode.removeChild(commentContainer);
}

  function toggleRating(index) {
    var ratings = document.getElementsByClassName('fa-star fa-2x');
    for (var i = 0; i <= index; i++) {
      ratings[i].classList.toggle('checked');
    }
  }
  </script>
</body>
</html>
